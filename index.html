<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Atmósfera - 1º ESO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .block-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 1rem 1rem 0 0;
        }
        .level-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 0.75rem 0.75rem 0 0;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script>
        const blocks = {
            1: { 
                title: "ORIGEN DE LA ATMÓSFERA", 
                icon: "🌋", 
                color: "from-orange-500 to-red-600",
                image: "imagenes/volcan-primitivo.jpg"
            },
            2: { 
                title: "COMPOSICIÓN DEL AIRE", 
                icon: "🌬️", 
                color: "from-blue-500 to-cyan-600",
                image: "imagenes/composicion-aire.png"
            },
            3: { 
                title: "CAPAS DE LA ATMÓSFERA", 
                icon: "🌍", 
                color: "from-indigo-500 to-purple-600",
                image: "imagenes/capas-atmosfera.jpg"
            },
            4: { 
                title: "FUNCIONES DE LA ATMÓSFERA", 
                icon: "🛡️", 
                color: "from-green-500 to-emerald-600",
                image: "imagenes/efecto-invernadero.jpg"
            }
        };

        const levelNames = {
            "1": { 
                "1.1": "Atmósfera primitiva",
                "1.2": "Formación de océanos", 
                "1.3": "Aparición de oxígeno",
                "1.4": "Atmósfera actual"
            },
            "2": { 
                "2.1": "Gas nitrógeno",
                "2.2": "Gas oxígeno",
                "2.3": "Gases minoritarios",
                "2.4": "Mezcla y propiedades"
            },
            "3": { 
                "3.1": "Troposfera",
                "3.2": "Estratosfera",
                "3.3": "Mesosfera y Termosfera",
                "3.4": "Exosfera"
            },
            "4": { 
                "4.1": "Protección contra meteoritos",
                "4.2": "Efecto invernadero",
                "4.3": "Capa de ozono",
                "4.4": "Amenazas ambientales"
            }
        };

        const levelImages = {
            "1-1.1": "imagenes/volcan-primitivo.jpg",
            "1-1.2": "imagenes/oceano-lluvia.jpg",
            "1-1.3": "imagenes/cianobacterias.jpg",
            "1-1.4": "imagenes/atmosfera-actual.jpg",
            "2-2.1": "imagenes/composicion-aire.png",
            "2-2.2": "imagenes/composicion-aire.png",
            "2-2.3": "imagenes/composicion-aire.png",
            "2-2.4": "imagenes/composicion-aire.png",
            "3-3.1": "imagenes/troposfera.jpg",
            "3-3.2": "imagenes/estratosfera-ozono.jpg",
            "3-3.3": "imagenes/aurora-boreal.jpg",
            "3-3.4": "imagenes/aurora-boreal.jpg",
            "4-4.1": "imagenes/meteorito.jpg",
            "4-4.2": "imagenes/efecto-invernadero.jpg",
            "4-4.3": "imagenes/proteccion-uv.jpg",
            "4-4.4": "imagenes/contaminacion-ciudad.jpg"
        };

        const secretWords = {
            "1-1.1": "LA",
            "1-1.2": "ATMÓSFERA",
            "1-1.3": "PROTEGE",
            "1-1.4": "LA",
            "2-2.1": "VIDA",
            "2-2.2": "EN",
            "2-2.3": "LA",
            "2-2.4": "TIERRA",
            "3-3.1": "GRACIAS",
            "3-3.2": "AL",
            "3-3.3": "OXÍGENO",
            "3-3.4": "Y",
            "4-4.1": "LA",
            "4-4.2": "CAPA",
            "4-4.3": "DE",
            "4-4.4": "OZONO"
        };

        const exerciseData = {
            "1-1.1": [
                { q: "¿Hace cuántos millones de años se formó la Tierra?", a: "4600", sol: "La Tierra se formó hace 4.600 millones de años" },
                { q: "¿La atmósfera primitiva tenía oxígeno? (sí/no)", a: "no", sol: "NO, la atmósfera primitiva NO tenía oxígeno" },
                { q: "¿Qué gas abundaba en la atmósfera primitiva?", a: "dioxido de carbono", sol: "Dióxido de carbono (CO₂)" },
                { q: "¿De dónde salían los gases de la atmósfera primitiva?", a: "volcanes", sol: "Los gases salían de los volcanes" },
                { q: "¿Qué otro gas había además del CO₂?", a: "vapor de agua", sol: "Vapor de agua (H₂O)" },
                { q: "¿La atmósfera primitiva era respirable? (sí/no)", a: "no", sol: "NO, era tóxica para los seres vivos actuales" },
                { q: "¿Qué expulsaban los volcanes?", a: "gases", sol: "Los volcanes expulsaban gases" }
            ],
            "1-1.2": [
                { q: "¿Qué ocurrió cuando la Tierra se enfrió?", a: "lluvia", sol: "El vapor de agua se condensó y empezó a llover" },
                { q: "¿Cuánto tiempo duró la lluvia? (millones de años)", a: "muchos", sol: "Llovió durante millones de años" },
                { q: "¿Qué se formó con la lluvia?", a: "oceanos", sol: "Se formaron los océanos" },
                { q: "¿Dónde se acumuló el agua de lluvia?", a: "depresiones", sol: "En las depresiones de la superficie terrestre" },
                { q: "¿El CO₂ se disolvió en el agua? (sí/no)", a: "si", sol: "Sí, parte del CO₂ se disolvió en los océanos" },
                { q: "¿Qué cubrió gran parte del planeta?", a: "agua", sol: "El agua cubrió gran parte del planeta" }
            ],
            "1-1.3": [
                { q: "¿Qué seres aparecieron en los océanos?", a: "cianobacterias", sol: "Las cianobacterias aparecieron hace 3.500 millones de años" },
                { q: "¿Qué proceso realizaban las cianobacterias?", a: "fotosintesis", sol: "Realizaban la fotosíntesis" },
                { q: "¿Qué gas producían las cianobacterias?", a: "oxigeno", sol: "Producían oxígeno (O₂)" },
                { q: "¿Cuándo empezó a haber oxígeno en la atmósfera? (millones años)", a: "2500", sol: "Hace unos 2.500 millones de años" },
                { q: "¿Las cianobacterias son plantas o bacterias?", a: "bacterias", sol: "Son bacterias fotosintéticas" },
                { q: "¿El oxígeno permitió la vida actual? (sí/no)", a: "si", sol: "Sí, el oxígeno permitió la evolución de la vida" }
            ],
            "1-1.4": [
                { q: "¿Qué porcentaje de nitrógeno tiene el aire actual?", a: "78", sol: "El 78% del aire es nitrógeno (N₂)" },
                { q: "¿Qué porcentaje de oxígeno tiene el aire?", a: "21", sol: "El 21% del aire es oxígeno (O₂)" },
                { q: "¿Qué porcentaje ocupan los demás gases?", a: "1", sol: "El 1% son otros gases (argón, CO₂, etc.)" },
                { q: "¿La atmósfera actual tiene mucho CO₂? (sí/no)", a: "no", sol: "NO, solo un 0,04% de CO₂" },
                { q: "¿La atmósfera actual es respirable? (sí/no)", a: "si", sol: "Sí, gracias al oxígeno" },
                { q: "¿Cuánto tardó en formarse la atmósfera actual? (miles millones años)", a: "4", sol: "Tardó unos 4.000 millones de años" }
            ],
            "2-2.1": [
                { q: "¿Qué porcentaje del aire es nitrógeno?", a: "78", sol: "El nitrógeno representa el 78%" },
                { q: "¿Cuál es la fórmula del nitrógeno?", a: "n2", sol: "N₂ (dos átomos de nitrógeno)" },
                { q: "¿El nitrógeno es reactivo o inerte?", a: "inerte", sol: "Es un gas inerte (poco reactivo)" },
                { q: "¿Para qué lo usan las plantas?", a: "proteinas", sol: "Las plantas lo necesitan para formar proteínas" },
                { q: "¿Las plantas toman N₂ del aire? (sí/no)", a: "no", sol: "NO, lo toman del suelo como nitratos" },
                { q: "¿El nitrógeno es el gas más abundante? (sí/no)", a: "si", sol: "Sí, es el más abundante del aire" }
            ],
            "2-2.2": [
                { q: "¿Qué porcentaje del aire es oxígeno?", a: "21", sol: "El oxígeno representa el 21%" },
                { q: "¿Cuál es la fórmula del oxígeno?", a: "o2", sol: "O₂ (dos átomos de oxígeno)" },
                { q: "¿Para qué usamos el oxígeno?", a: "respirar", sol: "Para respirar y obtener energía" },
                { q: "¿El oxígeno es reactivo? (sí/no)", a: "si", sol: "Sí, muy reactivo (permite combustiones)" },
                { q: "¿Qué proceso libera oxígeno?", a: "fotosintesis", sol: "La fotosíntesis de plantas y algas" },
                { q: "¿Sin oxígeno habría vida animal? (sí/no)", a: "no", sol: "NO, los animales necesitan oxígeno" }
            ],
            "2-2.3": [
                { q: "¿Qué gas noble hay en el aire?", a: "argon", sol: "El argón (0,9%)" },
                { q: "¿Qué porcentaje de CO₂ hay?", a: "0.04", sol: "0,04% de dióxido de carbono" },
                { q: "¿El CO₂ lo usan las plantas? (sí/no)", a: "si", sol: "Sí, para hacer la fotosíntesis" },
                { q: "¿Hay vapor de agua en el aire? (sí/no)", a: "si", sol: "Sí, en cantidad variable" },
                { q: "¿El vapor de agua forma las nubes? (sí/no)", a: "si", sol: "Sí, al condensarse forma nubes" },
                { q: "¿Hay partículas sólidas en el aire? (sí/no)", a: "si", sol: "Sí, polvo, polen, humo, etc." },
                { q: "¿El polen es una partícula en suspensión? (sí/no)", a: "si", sol: "Sí, el polen es una partícula en suspensión" },
                { q: "¿El polvo y el humo son partículas en suspensión? (sí/no)", a: "si", sol: "Sí, el polvo y el humo son partículas en suspensión" }
            ],
            "2-2.4": [
                { q: "¿La atmósfera es homogénea en todas sus capas? (sí/no)", a: "no", sol: "NO, la atmósfera NO es homogénea; tiene distintas capas" },
                { q: "¿Cuántas capas principales tiene la atmósfera?", a: "5", sol: "La atmósfera tiene 5 capas principales" },
                { q: "Suma los porcentajes de nitrógeno y oxígeno", a: "99", sol: "78% + 21% = 99%" },
                { q: "¿Qué nombre recibe la mezcla de gases que respiramos?", a: "aire", sol: "La mezcla de gases se llama aire" },
                { q: "¿El aire tiene masa? (sí/no)", a: "si", sol: "Sí, el aire tiene masa y peso" }
            ],
            "3-3.1": [
                { q: "¿Cuál es la capa más cercana a la superficie terrestre?", a: "troposfera", sol: "La troposfera es la capa más cercana a la Tierra" },
                { q: "¿Hasta qué altura llega la troposfera? (en km)", a: "12", sol: "La troposfera llega hasta los 12 km de altura" },
                { q: "¿Qué porcentaje del aire está en la troposfera?", a: "80", sol: "La troposfera contiene el 80% del aire" },
                { q: "¿Dónde ocurren las lluvias y tormentas?", a: "troposfera", sol: "Los fenómenos meteorológicos ocurren en la troposfera" },
                { q: "¿La temperatura en la troposfera aumenta o disminuye con la altura?", a: "disminuye", sol: "La temperatura disminuye con la altura en la troposfera" },
                { q: "¿A qué temperatura puede llegar el límite superior de la troposfera?", a: "-70", sol: "Puede llegar a -70°C en su límite superior" },
                { q: "¿En qué capa vuelan los aviones comerciales?", a: "troposfera", sol: "Los aviones comerciales vuelan en la troposfera" }
            ],
            "3-3.2": [
                { q: "¿Entre qué alturas se encuentra la estratosfera? (km)", a: "12 50", sol: "La estratosfera está entre los 12 y 50 km de altura" },
                { q: "¿Qué capa protectora importante hay en la estratosfera?", a: "ozono", sol: "La capa de ozono está en la estratosfera" },
                { q: "¿Qué radiación bloquea la capa de ozono?", a: "ultravioleta", sol: "La capa de ozono bloquea los rayos ultravioleta" },
                { q: "¿La temperatura en la estratosfera aumenta o disminuye con la altura?", a: "aumenta", sol: "La temperatura aumenta con la altura en la estratosfera" },
                { q: "¿Hasta qué temperatura puede llegar la estratosfera?", a: "0", sol: "Puede llegar hasta los 0°C" },
                { q: "¿Por qué aumenta la temperatura en la estratosfera?", a: "absorcion ultravioleta", sol: "Por la absorción de radiación ultravioleta por el ozono" }
            ],
            "3-3.3": [
                { q: "¿Entre qué alturas está la mesosfera? (km)", a: "50 80", sol: "La mesosfera está entre los 50 y 80 km" },
                { q: "¿Es la mesosfera la capa más fría o más caliente?", a: "fria", sol: "La mesosfera es la capa MÁS FRÍA de la atmósfera" },
                { q: "¿Qué temperatura mínima alcanza la mesosfera?", a: "-100", sol: "Puede llegar a -100°C" },
                { q: "¿Qué se desintegra en la mesosfera?", a: "meteoritos", sol: "Los meteoritos se desintegran en la mesosfera" },
                { q: "¿Cómo se llaman las 'estrellas fugaces'?", a: "meteoritos", sol: "Son meteoritos que se desintegran en la mesosfera" },
                { q: "¿Entre qué alturas está la termosfera? (km)", a: "80 500", sol: "La termosfera está entre los 80 y 500 km" },
                { q: "¿Qué temperatura puede alcanzar la termosfera?", a: "1500", sol: "Puede superar los 1.500°C" },
                { q: "¿Qué fenómeno luminoso ocurre en la termosfera?", a: "auroras boreales", sol: "Las auroras boreales ocurren en la termosfera" }
            ],
            "3-3.4": [
                { q: "¿Cuál es la capa más externa de la atmósfera?", a: "exosfera", sol: "La exosfera es la capa más externa" },
                { q: "¿A qué altura comienza la exosfera? (km)", a: "600", sol: "La exosfera comienza alrededor de los 600 km" },
                { q: "¿Hasta dónde se extiende la exosfera? (km)", a: "10000", sol: "Se extiende hasta los 10.000 km" },
                { q: "¿Qué tipo de satélites están en la exosfera?", a: "geoestacionarios", sol: "Los satélites geoestacionarios están en la exosfera" },
                { q: "¿La composición de la exosfera es igual al espacio? (sí/no)", a: "si", sol: "Sí, su composición es igual al espacio interplanetario" },
                { q: "¿Dónde orbita la Estación Espacial Internacional?", a: "termosfera", sol: "La ISS orbita en la termosfera (unos 400 km)" }
            ],
            "4-4.1": [
                { q: "¿Qué protege la atmósfera de los meteoritos?", a: "friccion", sol: "La fricción con el aire los desintegra" },
                { q: "¿En qué capa se queman los meteoritos?", a: "mesosfera", sol: "Se desintegran en la mesosfera" },
                { q: "¿Cómo se ve un meteorito desde la Tierra?", a: "estrella fugaz", sol: "Como una estrella fugaz" },
                { q: "¿Todos los meteoritos llegan al suelo? (sí/no)", a: "no", sol: "NO, la mayoría se desintegran en el aire" },
                { q: "¿La atmósfera actúa como escudo? (sí/no)", a: "si", sol: "Sí, protege de impactos de meteoritos" }
            ],
            "4-4.2": [
                { q: "¿Qué gases causan el efecto invernadero?", a: "co2 vapor agua", sol: "CO₂ y vapor de agua principalmente" },
                { q: "¿El efecto invernadero es bueno o malo?", a: "necesario", sol: "Es necesario para la vida (con moderación)" },
                { q: "¿Qué temperatura habría sin efecto invernadero?", a: "-18", sol: "Unos -18°C (imposible para la vida)" },
                { q: "¿El exceso de CO₂ causa calentamiento? (sí/no)", a: "si", sol: "Sí, causa calentamiento global" },
                { q: "¿De dónde viene el exceso de CO₂?", a: "combustibles fosiles", sol: "De quemar combustibles fósiles" }
            ],
            "4-4.3": [
                { q: "¿Qué capa filtra los rayos ultravioleta?", a: "ozono", sol: "La capa de ozono" },
                { q: "¿En qué capa está el ozono?", a: "estratosfera", sol: "En la estratosfera" },
                { q: "¿Qué daños causan los rayos UV?", a: "cancer piel", sol: "Cáncer de piel, quemaduras, daño ocular" },
                { q: "¿Qué sustancias dañan el ozono?", a: "cfc", sol: "Los CFC (clorofluorocarbonos)" },
                { q: "¿Hay un agujero de ozono? (sí/no)", a: "si", sol: "Sí, principalmente sobre la Antártida" }
            ],
            "4-4.4": [
                { q: "¿Qué causa la lluvia ácida?", a: "so2 nox", sol: "SO₂ y NOₓ de industrias y vehículos" },
                { q: "¿La contaminación daña la atmósfera? (sí/no)", a: "si", sol: "Sí, altera su composición y funciones" },
                { q: "¿Qué efecto tiene el aumento de CO₂?", a: "calentamiento", sol: "Aumenta el calentamiento global" },
                { q: "¿Debemos cuidar la atmósfera? (sí/no)", a: "si", sol: "Sí, es esencial para la vida" },
                { q: "¿Las energías renovables ayudan? (sí/no)", a: "si", sol: "Sí, reducen la contaminación atmosférica" }
            ]
        };

        let state = {
            selectedBlock: null,
            selectedLevel: null,
            answers: {},
            showResults: {},
            studentName: localStorage.getItem('studentName') || '',
            showNameModal: !localStorage.getItem('studentName'),
            collectedWords: JSON.parse(localStorage.getItem('collectedWords') || '{}'),
            completedLevels: JSON.parse(localStorage.getItem('completedLevels') || '{}')
        };

        function saveState() {
            localStorage.setItem('studentName', state.studentName);
            localStorage.setItem('collectedWords', JSON.stringify(state.collectedWords));
            localStorage.setItem('completedLevels', JSON.stringify(state.completedLevels));
        }

        function checkAnswer(key, correct) {
            const userAnswer = (state.answers[key] || '').trim().toLowerCase().replace(/\s+/g, ' ');
            const correctAnswers = correct.toLowerCase().split(' ');
            
            const isCorrect = correctAnswers.every(ans => 
                userAnswer.includes(ans.replace(/\s/g, ''))
            );
            
            state.showResults[key] = isCorrect;
            checkLevelCompletion();
            render();
        }

        function checkLevelCompletion() {
            if (!state.selectedBlock || !state.selectedLevel) return;
            
            const levelKey = state.selectedBlock + '-' + state.selectedLevel;
            const exercises = exerciseData[levelKey] || [];
            
            let allAnswered = true;
            let allCorrect = true;
            
            exercises.forEach((ex, idx) => {
                const key = levelKey + '-' + idx;
                if (state.showResults[key] === undefined) {
                    allAnswered = false;
                } else if (!state.showResults[key]) {
                    allCorrect = false;
                }
            });
            
            if (allAnswered && allCorrect && !state.completedLevels[levelKey]) {
                state.completedLevels[levelKey] = true;
                state.collectedWords[levelKey] = secretWords[levelKey];
                saveState();
                showCongratulations(levelKey);
            }
        }

        function showCongratulations(levelKey) {
            const word = secretWords[levelKey];
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center animate-bounce">
                    <div class="text-6xl mb-4">🎉</div>
                    <h2 class="text-3xl font-bold text-green-600 mb-4">¡Nivel Completado!</h2>
                    <p class="text-gray-700 mb-4">Has desbloqueado una palabra secreta:</p>
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-4xl font-bold py-6 px-8 rounded-xl mb-6 shadow-lg">
                        ${word}
                    </div>
                    <p class="text-sm text-gray-600 mb-6">Anótala en tu hoja de recogida 📝</p>
                    <button onclick="closeModal()" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition font-medium">
                        Continuar
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) modal.remove();
            render();
        }

        function render() {
            const app = document.getElementById('app');
            const totalWords = Object.keys(state.collectedWords).length;
            const totalLevels = Object.keys(secretWords).length;
            
            let html = '';

            if (state.showNameModal && !state.studentName) {
                html += `<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">¡Bienvenido/a!</h2>
                        <p class="text-gray-600 mb-6">Por favor, introduce tu nombre para comenzar:</p>
                        <input type="text" id="nameInput" placeholder="Tu nombre completo" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none mb-4">
                        <button onclick="setName()" class="w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition font-medium">
                            Comenzar
                        </button>
                    </div>
                </div>`;
            }

            html += `<div class="min-h-screen bg-gradient-to-br from-sky-100 via-blue-50 to-indigo-100 p-4">
                <div class="max-w-7xl mx-auto">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl shadow-2xl p-8 mb-8 text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full -mr-32 -mt-32"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                                <div class="flex items-center gap-4">
                                    <div class="text-6xl">🌍</div>
                                    <div>
                                        <h1 class="text-4xl font-bold mb-2">La Atmósfera</h1>
                                        <p class="text-blue-100 text-lg">1º ESO - Biología y Geología 🚀</p>
                                        ${state.studentName ? `<p class="text-blue-200 text-sm mt-1">👤 ${state.studentName}</p>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-4 mt-6 flex-wrap">
                                <div class="bg-white bg-opacity-20 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold">✨ 4 Bloques Temáticos</span></div>
                                <div class="bg-white bg-opacity-20 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold">📚 16 Niveles</span></div>
                                <div class="bg-white bg-opacity-20 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold">🎯 +120 Ejercicios</span></div>
                                <div class="bg-yellow-400 bg-opacity-90 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold text-gray-800">🔤 ${totalWords}/${totalLevels} palabras secretas</span></div>
                            </div>
                        </div>
                    </div>
                    ${!state.selectedBlock ? renderBlockSelection() : (!state.selectedLevel ? renderLevelSelection() : renderExercises())}
                </div>
            </div>`;

            app.innerHTML = html;
        }

        function renderBlockSelection() {
            return `<div>
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <span class="text-3xl">🏆</span> Selecciona un Bloque Temático
                </h2>
                <div class="grid md:grid-cols-2 gap-6">
                    ${Object.entries(blocks).map(([id, block]) => `
                        <div onclick="selectBlock('${id}')" class="bg-white rounded-2xl shadow-xl cursor-pointer transform transition-all duration-300 hover:scale-105 hover:shadow-2xl overflow-hidden">
                            <img src="${block.image}" alt="${block.title}" class="block-image" onerror="this.style.display='none'">
                            <div class="p-6">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="text-5xl">${block.icon}</div>
                                    <span class="bg-gradient-to-r ${block.color} text-white px-3 py-1 rounded-full text-sm font-bold">
                                        Bloque ${id}
                                    </span>
                                </div>
                                <h3 class="font-bold text-xl text-gray-800 mb-3">${block.title}</h3>
                                <div class="flex items-center text-indigo-600 font-medium">
                                    Comenzar <span class="ml-2">→</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="mt-8 bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">🔤</span> Palabras Secretas Recogidas
                    </h3>
                    <div class="flex flex-wrap gap-3">
                        ${Object.entries(state.collectedWords).map(([key, word]) => `
                            <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-4 py-2 rounded-lg font-bold shadow-md">
                                ${word}
                            </div>
                        `).join('') || '<p class="text-gray-500 italic">Completa niveles para desbloquear palabras secretas...</p>'}
                    </div>
                </div>
            </div>`;
        }

        function renderLevelSelection() {
            const block = blocks[state.selectedBlock];
            return `<div>
                <button onclick="backToBlocks()" class="mb-6 px-6 py-3 bg-white rounded-xl hover:bg-gray-50 transition shadow-lg flex items-center gap-2">
                    ← Volver a Bloques
                </button>
                
                <div class="bg-gradient-to-r ${block.color} rounded-2xl shadow-xl p-8 mb-8 text-white">
                    <div class="flex items-center gap-4">
                        <div class="text-6xl">${block.icon}</div>
                        <div>
                            <h2 class="text-3xl font-bold mb-2">${block.title}</h2>
                            <p class="text-white text-opacity-90">Selecciona un nivel para practicar</p>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    ${Object.entries(levelNames[state.selectedBlock] || {}).map(([levelId, levelName]) => {
                        const levelKey = state.selectedBlock + '-' + levelId;
                        const isCompleted = state.completedLevels[levelKey];
                        const image = levelImages[levelKey];
                        return `
                            <div onclick="selectLevel('${levelId}')" class="bg-white rounded-xl shadow-lg cursor-pointer hover:shadow-2xl transition-all overflow-hidden">
                                <img src="${image}" alt="${levelName}" class="level-image" onerror="this.style.display='none'">
                                <div class="p-6">
                                    <div class="flex items-center justify-between mb-3">
                                        <span class="bg-gradient-to-r from-green-400 to-green-600 text-white px-4 py-1 rounded-full text-sm font-bold">
                                            Nivel ${levelId}
                                        </span>
                                        ${isCompleted ? `<span class="text-2xl">✅</span>` : ''}
                                    </div>
                                    <h3 class="font-bold text-xl text-gray-800 mb-2">${levelName}</h3>
                                    <div class="flex items-center text-indigo-600 font-medium mt-4">
                                        Practicar <span class="ml-2">→</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>`;
        }

        function renderExercises() {
            const exercises = exerciseData[state.selectedBlock + '-' + state.selectedLevel] || [];
            const levelKey = state.selectedBlock + '-' + state.selectedLevel;
            const isCompleted = state.completedLevels[levelKey];
            
            return `<div>
                <div class="flex gap-2 mb-6 flex-wrap">
                    <button onclick="backToLevels()" class="px-4 py-2 bg-white rounded-lg shadow hover:bg-gray-50 transition">
                        ← Niveles
                    </button>
                    <button onclick="backToBlocks()" class="px-4 py-2 bg-white rounded-lg shadow hover:bg-gray-50 transition">
                        🏠 Inicio
                    </button>
                    ${isCompleted ? `<div class="px-4 py-2 bg-green-100 rounded-lg shadow font-semibold text-green-800 flex items-center gap-2">
                        <span class="text-xl">✅</span> Nivel Completado
                    </div>` : ''}
                </div>

                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                    <h2 class="text-2xl font-bold text-indigo-900 mb-2">
                        Nivel ${state.selectedLevel}: ${levelNames[state.selectedBlock]?.[state.selectedLevel]}
                    </h2>
                    <p class="text-gray-600">Responde todas las preguntas correctamente para desbloquear una palabra secreta 🔤</p>
                </div>

                <div class="space-y-6">
                    ${exercises.map((ex, idx) => {
                        const key = levelKey + '-' + idx;
                        const result = state.showResults[key];
                        return `
                            <div class="bg-white border-2 ${result === true ? 'border-green-300' : (result === false ? 'border-red-300' : 'border-gray-200')} rounded-xl p-6 hover:border-indigo-300 transition">
                                <div class="flex items-start gap-4">
                                    <span class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-bold min-w-fit">
                                        #${idx + 1}
                                    </span>
                                    <div class="flex-1">
                                        <div class="text-xl font-medium mb-4">${ex.q}</div>
                                        <div class="flex gap-2">
                                            <input
                                                type="text"
                                                id="answer-${key}"
                                                value="${state.answers[key] || ''}"
                                                oninput="updateAnswer('${key}', this.value)"
                                                placeholder="Tu respuesta"
                                                class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none text-lg"
                                            />
                                            <button
                                                onclick="checkAnswer('${key}', '${ex.a}')"
                                                class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition font-medium shadow-lg"
                                            >
                                                Comprobar
                                            </button>
                                        </div>

                                        ${result !== undefined ? `
                                            <div class="mt-4 p-4 rounded-lg ${result ? 'bg-green-50 border-2 border-green-300' : 'bg-red-50 border-2 border-red-300'}">
                                                <div class="flex items-center gap-2 mb-2">
                                                    ${result ? `
                                                        <span class="text-2xl">✅</span>
                                                        <span class="font-bold text-green-800 text-lg">¡Correcto! 🎉</span>
                                                    ` : `
                                                        <span class="text-2xl">❌</span>
                                                        <span class="font-bold text-red-800 text-lg">Incorrecto. Inténtalo de nuevo</span>
                                                    `}
                                                </div>
                                                ${!result ? `<div class="text-gray-700"><strong>Pista:</strong> ${ex.sol}</div>` : ''}
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>`;
        }

        function setName() {
            const input = document.getElementById('nameInput');
            if (input.value.trim()) {
                state.studentName = input.value.trim();
                state.showNameModal = false;
                saveState();
                render();
            }
        }

        function selectBlock(id) {
            state.selectedBlock = id;
            state.selectedLevel = null;
            render();
        }

        function selectLevel(id) {
            state.selectedLevel = id;
            render();
        }

        function backToBlocks() {
            state.selectedBlock = null;
            state.selectedLevel = null;
            render();
        }

        function backToLevels() {
            state.selectedLevel = null;
            render();
        }

        function updateAnswer(key, value) {
            state.answers[key] = value;
        }

        window.setName = setName;
        window.selectBlock = selectBlock;
        window.selectLevel = selectLevel;
        window.backToBlocks = backToBlocks;
        window.backToLevels = backToLevels;
        window.updateAnswer = updateAnswer;
        window.checkAnswer = checkAnswer;
        window.closeModal = closeModal;

        document.addEventListener('DOMContentLoaded', function() {
            render();
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('nameInput')) {
                    setName();
                }
            });
        });
    </script>
</body>
</html>